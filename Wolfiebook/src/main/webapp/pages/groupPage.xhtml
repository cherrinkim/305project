<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition  template="/WEB-INF/templates/usertemplate.xhtml">
        <ui:define name="content">
            <h:form id="GroupPageForm">
                <p:growl id="groupPageGrowl" life="3000"/>
                <div class="ui-g" style="margin-bottom:30px;">
                    <div class="ui-g-8">
                        <p:inputTextarea id="postMessage" value="#{pageBean.postContent}" required="true" requiredMessage="#{bundle['msg.postcontent.validation']}" style="width:100%; min-height:150px;"/>
                    </div>
                    <div class="ui-g-4">
                        <p:commandButton update="datalist" id="post-btn" value="post" action="#{pageBean.newGroupPost(groupBean.selected)}"/>
                    </div>
                </div>
            </h:form>
            <p:dataTable id="datalist" value="#{pageBean.getGroupPosts(groupBean.selected)}" var="post" widgetVar="pageTable" lazy="false"
                         emptyMessage="No posts found" rowsPerPageTemplate="5,10,15" rowKey="#{post.postId}" selectionMode="single" 
                         selection="#{pageBean.selected}" paginator="true">
                <p:column style="width:16px">
                    <p:rowToggler />
                </p:column>
                <p:column headerText="Content">
                    <h:outputText value="#{post.content}" escape="false"/>
                </p:column>
                <p:column headerText="Author">
                    <h:outputText value="#{post.authorId.firstName} #{post.authorId.lastName}"/>
                </p:column>
                <p:column headerText="Created Date">
                    <h:outputText value="#{post.dateCreated}"/>
                </p:column>

                <p:column> 
                    <p:panelGrid columns="2" layout="grid" styleClass="panelGrid">
                        <h:form>      
                            <p:commandButton id="likeButton" value="#{pageBean.checkLikedPost(post)}" action="#{pageBean.likePost(post)}"/> 
                        </h:form> 
                        <h:form>      
                            <p:commandButton id="deletePostButton" value="Delete Post" action="#{pageBean.deletePost(post, groupBean.selected)}"/> 
                        </h:form> 
                    </p:panelGrid>

                </p:column> 
                <p:rowExpansion>
                    <p:inputText id="postComment" value="#{pageBean.commentContent}"
                                 required="true" requiredMessage="#{bundle['msg.commentcontent.validation']}"/>
                    <p:commandButton update="commentlist" id="comment-btn" value="comment" action="#{pageBean.newComment(pageBean.selected)}"/>
                    <p:dataTable id="commentlist" value="#{post.commentsList}" var="comment" widgetVar="commentTable" lazy="false"
                                 emptyMessage="No commnets found" rowsPerPageTemplate="5,10,15">
                        <p:column headerText="Content">
                            <h:outputText value="#{comment.content}" escape="false"/>
                        </p:column>
                        <p:column headerText="Author">
                            <h:outputText value="#{comment.authorId.firstName} #{comment.authorId.lastName}"/>
                        </p:column>
                        <p:column headerText="Created Date">
                            <h:outputText value="#{comment.dateCreated}"/>
                        </p:column>
                    </p:dataTable>
                </p:rowExpansion>
            </p:dataTable>

        </ui:define>
    </ui:composition>
</html>

